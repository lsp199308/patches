This guide will cover how to make two specific fs patches, with System Firmware Version 13.0.0 targeted. It also assumes you have sorted your firmware files as described in part 2.

**note:** the patch only has to be done on either fat32 or exfat, you just need the sha256 of the fs.kip1 

**this guide hasn't been formatted nicely yet, feel free to do it if you're interested, otherwise i'll do it sometime in the future**


for the fat32 the titleid is 0100000000000819
hactool firmware_files\1300\0100000000000819\c0cb231da1d3706d346d189779ba82f3.nca --romfsdir fat32romfs
hactool -t pk21 fat32romfs/nx/package2 --ini1dir fat32

certUtil -hashfile fat32/fs.kip1 SHA256 (for windows cmd prompt), Get-Filehash fat32/Fs.kip1 (for windows powershell) or sha256sum fat32/Fs.kip1 for linux terminal
Write this hash down. (7D200547178A836A24993B002AFD83D0B662AA7177E935C04C36EAC21BAC24AA fat32 13.0.0)


for the exfat the titleid is 010000000000081B
hactool firmware_files\010000000000081B\adc64b133167ad1c41a1a3de148cc73c.nca --romfsdir exfatromfs

hactool -t pk21 exfatromfs/nx/package2 --ini1dir exfat

certUtil -hashfile exfat/fs.kip1 SHA256 (for windows cmd prompt), Get-Filehash exfat/Fs.kip1 (for windows powershell) or sha256sum exfat/Fs.kip1 for linux terminal
Write this hash down. (51EBFA9CCF66C09EC796C069C6C6D03C01D504CC0B17F4FAA919446E7E9DB107 exfat 13.0.0)

hactool -t kip1 fat32/fs.kip1 --uncompressed=uncompressed_fat32

Import uncompressed_fat32 into ghidra, analyze it, wait until process complete. (you don't have to do this for the exfat binary)
press ok if there are any errors



patch the offset (as pictured) with a NOP instruction (1F2003D5)

for the first patch press S, search for binary string "........ 000000.. 01000000 11111001 ........ ........ ........ 100101.. ........ 0....... 00...... 00010010 ...11111 ........ 00...... 01110001 ...00001 ........ ........ 01010100 ........ ........ ........ .0110111" (the offset you're patching is the second BL arm instruction) This search string is for the instruction pattern at the function that is being patched, it permits for installing .xci sourced ncas without converting the header.

![alt text](https://github.com/borntohonk/patches/blob/master/img/ghidra-fs-offset1.png?raw=true)

for the second patch press S, search for binary string "........ ........ 01...... 10111001 ...11111 ........ 01...... 01110001 ...00011 ........ ........ 01010100 ........ ........ 01...... 00111001 ...11111 ........ 00...... 01110001 ...01000 ........ ........ 01010100 ........ ........ 00...... 10010001" (the offset you're patching is the TBZ arm instruction above the search result) patch this offset with a "NOP" instruction (1F 20 03 D5). This patch permits to install signature broken .ncas, such as homebrew or .xci conversions.

patch offset (as pictured) with a MOV, w0, WZR instruction. (E0031F2A)

![alt text](https://github.com/borntohonk/patches/blob/master/img/ghidra-fs-offset2.png?raw=true)

Save the end result as string after merging the output offset, sizes and patches to be applied 
(50 41 54 43 48 07 AF C8 00 04 E0 03 1F 2A 0E F4 20 00 04 1F 20 03 D5 45 4F 46) as 7D200547178A836A24993B002AFD83D0B662AA7177E935C04C36EAC21BAC24AA.ips and 
51EBFA9CCF66C09EC796C069C6C6D03C01D504CC0B17F4FAA919446E7E9DB107.ips

You now have succesfully patched out two different checks that prevent installing homebrew/xci and it can be used with Atmosphere by putting it into /atmosphere/kip_patches/fs_patches/32153D9896AE0C7C723F04EC1CE20999CAF7ED69.ips and /atmosphere/kip_patches/fs_patches/51EBFA9CCF66C09EC796C069C6C6D03C01D504CC0B17F4FAA919446E7E9DB107.ips